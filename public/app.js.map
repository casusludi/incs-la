{"version":3,"sources":["app/components/ChangeLocation.js","app/components/Investigate.js","app/components/JSONReader.js","app/initialize.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA/DA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzFA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAvCA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAtMA;AAAA","file":"public/app.js","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.ChangeLocation = ChangeLocation;\n\nvar _xstream = require('xstream');\n\nvar _xstream2 = _interopRequireDefault(_xstream);\n\nvar _run = require('@cycle/run');\n\nvar _isolate = require('@cycle/isolate');\n\nvar _isolate2 = _interopRequireDefault(_isolate);\n\nvar _snabbdomJsx = require('snabbdom-jsx');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction intent(sources) {\n\n    var click$ = sources.DOM.select('.js-change-location').events('click');\n\n    return click$;\n}\n\nfunction model(newLocation$) {\n    return newLocation$.remember();\n}\n\nfunction view(state$) {\n    return state$.map(function (state) {\n        return (0, _snabbdomJsx.html)(\n            'button',\n            { selector: '.js-change-location', type: 'button' },\n            state\n        );\n    });\n}\n\nfunction _ChangeLocation(sources) {\n    var action$ = intent(sources);\n    var state$ = model(sources.newLocation$);\n    var vdom$ = view(state$);\n\n    var sinks = {\n        DOM: vdom$,\n        newLocation$: action$.map(function (action) {\n            return state$.map(function (state) {\n                return state;\n            });\n        }).flatten(),\n        test$: _xstream2.default.fromDiagram('--a--b---c-d--|', { timeUnit: 1000 })\n    };\n\n    return sinks;\n}\n\nfunction ChangeLocation(sources) {\n    return (0, _isolate2.default)(_ChangeLocation)(sources);\n};\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.Investigate = Investigate;\n\nvar _xstream = require('xstream');\n\nvar _xstream2 = _interopRequireDefault(_xstream);\n\nvar _run = require('@cycle/run');\n\nvar _isolate = require('@cycle/isolate');\n\nvar _isolate2 = _interopRequireDefault(_isolate);\n\nvar _snabbdomJsx = require('snabbdom-jsx');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction intent(DOM) {\n    return DOM.select('.js-investigate').events('click').mapTo(true);\n}\n\nfunction model(action$, props$) {\n    return props$.map(function (props) {\n        return action$.map(function (val) {\n            return {\n                name: props.name,\n                image: props.image,\n                dialog: props.dialog,\n                clue: props.clue,\n                showResult: val\n            };\n        }).startWith(props);\n    }).flatten().remember();\n}\n\nfunction view(state$) {\n    return state$.map(function (state) {\n        return (0, _snabbdomJsx.html)(\n            'section',\n            { selector: '.place-item' },\n            state.showResult ? (0, _snabbdomJsx.html)(\n                'figure',\n                null,\n                (0, _snabbdomJsx.html)('img', { src: state.image }),\n                (0, _snabbdomJsx.html)(\n                    'figcaption',\n                    null,\n                    state.clue ? (0, _snabbdomJsx.html)(\n                        'span',\n                        null,\n                        state.clue.text\n                    ) : (0, _snabbdomJsx.html)(\n                        'span',\n                        null,\n                        state.dialog\n                    )\n                )\n            ) : (0, _snabbdomJsx.html)(\n                'button',\n                { selector: '.js-investigate', type: 'button' },\n                state.name\n            )\n        );\n    });\n}\n\nfunction _Investigate(sources) {\n\n    var action$ = intent(sources.DOM);\n    var state$ = model(action$, sources.props);\n    var vdom$ = view(state$);\n\n    var sinks = {\n        DOM: vdom$,\n        value: state$.map(function (state) {\n            return !!state.showResult;\n        })\n    };\n\n    return sinks;\n}\n\nfunction Investigate(sources) {\n    return (0, _isolate2.default)(_Investigate)(sources);\n};\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.JSONReader = JSONReader;\n\nvar _xstream = require('xstream');\n\nvar _xstream2 = _interopRequireDefault(_xstream);\n\nvar _run = require('@cycle/run');\n\nvar _isolate = require('@cycle/isolate');\n\nvar _isolate2 = _interopRequireDefault(_isolate);\n\nvar _snabbdomJsx = require('snabbdom-jsx');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction JSONReader(sources) {\n\n    var request$ = _xstream2.default.of({\n        url: '/data.json',\n        category: 'data'\n    });\n\n    var response$ = sources.HTTP.select('data').flatten().map(function (response) {\n        return response.body;\n    });\n\n    var sinks = {\n        JSON: response$,\n        request: request$\n    };\n\n    return sinks;\n}\n","'use strict';\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nvar _xstream = require('xstream');\n\nvar _xstream2 = _interopRequireDefault(_xstream);\n\nvar _run = require('@cycle/run');\n\nvar _dom = require('@cycle/dom');\n\nvar _http = require('@cycle/http');\n\nvar _collection = require('@cycle/collection');\n\nvar _collection2 = _interopRequireDefault(_collection);\n\nvar _fromDiagram = require('xstream/extra/fromDiagram');\n\nvar _fromDiagram2 = _interopRequireDefault(_fromDiagram);\n\nvar _dropRepeats = require('xstream/extra/dropRepeats');\n\nvar _dropRepeats2 = _interopRequireDefault(_dropRepeats);\n\nvar _delay = require('xstream/extra/delay');\n\nvar _delay2 = _interopRequireDefault(_delay);\n\nvar _snabbdomJsx = require('snabbdom-jsx');\n\nvar _Investigate = require('./components/Investigate.js');\n\nvar _ChangeLocation = require('./components/ChangeLocation.js');\n\nvar _JSONReader = require('./components/JSONReader.js');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction main(sources) {\n\n  var jsonSinks = (0, _JSONReader.JSONReader)({ HTTP: sources.HTTP });\n  var jsonRequest$ = jsonSinks.request;\n  var jsonResponse$ = jsonSinks.JSON;\n\n  /////////////////////////////\n  // OLD (use of Collection) //\n  /////////////////////////////\n  /* \r\n  const proxyChangeLocation$ = xs.create(); \r\n  \r\n  // const locationLinks$ = proxyChangeLocation$.map(currentLocation =>\r\n  //     jsonResponse$.map(jsonResponse =>\r\n  //         jsonResponse.locations[currentLocation].links.map(link => ({\r\n  //             newLocation$: xs.of(link),\r\n  //         }))\r\n  //     )\r\n  // ).flatten();\r\n  \r\n  const add$ = jsonResponse$.map(jsonResponse =>\r\n      proxyChangeLocation$.map(currentLocation =>\r\n          jsonResponse.locations[currentLocation].links.map(link => ({\r\n              newLocation$: xs.of(link),\r\n          }))\r\n      )\r\n  ).flatten();\r\n    const progression$ = add$.mapTo(1).fold((acc, x) => acc + x, 0);\r\n    const locations$ = Collection(\r\n    ChangeLocation,\r\n    {DOM: sources.DOM, destroy$: proxyChangeLocation$.mapTo(null)},\r\n    add$.compose(delay(1)),\r\n    item => item.destroy$\r\n  );\r\n    const locationsVTree$ = Collection.pluck(locations$, item => item.DOM);\r\n  const newLocationInfo$ = Collection.merge(locations$, item => item.newLocation$);\r\n    const changeLocation$ = xs.merge(\r\n    xs.of('la-baule'),\r\n    newLocationInfo$,\r\n  );\r\n    const currentLocation$ = changeLocation$.remember();\r\n    // proxyChangeLocation$.imitate(newLocationInfo$.compose(dropRepeats));\r\n    // const currentLocation$ = newLocationInfo$\r\n  //   .startWith('la-baule');\r\n    \r\n  proxyChangeLocation$.imitate(currentLocation$.compose(dropRepeats()));\r\n    const DOMSink$ = xs.combine(currentLocation$, progression$, locationsVTree$).map(\r\n      ([currentLocation, progression, locationsVTree]) =>\r\n        <div>\r\n          <p>\r\n            Progression : {progression}\r\n          </p>\r\n          <h1>{currentLocation}</h1>\r\n          <div selector=\".items\">\r\n            {locationsVTree}\r\n          </div>\r\n        </div>\r\n    );\r\n  */\n\n  ///// SANS COLLECTION /////\n  var action$ = sources.DOM.select('.js-change-location').events('click');\n\n  var clickedLocation$ = _xstream2.default.merge(action$.map(function (action) {\n    return action.target.value;\n  }), _xstream2.default.of(\"None\"));\n\n  var progression$ = action$.mapTo(1).fold(function (acc, x) {\n    return acc + x;\n  }, 0);\n\n  var currentLocation$ = action$.map(function (action) {\n    return clickedLocation$;\n  }).flatten().startWith(\"nantes\");\n\n  var currentLocationLinks$ = jsonResponse$.map(function (jsonResponse) {\n    return currentLocation$.map(function (currentLocation) {\n      return jsonResponse.locations[currentLocation].links;\n    });\n  }).flatten().debug(\"currentLocationLinks\");\n\n  var changeLocationButtons$ = currentLocationLinks$.compose((0, _dropRepeats2.default)()).debug(\"dropRepeats\").map(function (currentLocationLinks) {\n    return currentLocationLinks.map(function (currentLocationLink) {\n      return (0, _ChangeLocation.ChangeLocation)({ newLocation$: _xstream2.default.of(currentLocationLink) });\n    });\n  }).debug(\"changeLocationButtons\");\n\n  changeLocationButtons$.addListener({\n    next: function next(value) {\n      console.log('The Stream gave me a value: ', value);\n    }\n  });\n\n  // const newLocation$ = changeLocationButtons$.map(changeLocationButtons =>\n  //   xs.merge(...(changeLocationButtons.map(changeLocationButton => changeLocationButton.newLocation$)))\n  // ).flatten();\n\n  changeLocationButtons$.addListener({\n    next: function next(value) {\n      console.log('The Stream gave me a value: ', value);\n    }\n  });\n\n  var DOMSink$ = _xstream2.default.combine(currentLocation$, currentLocationLinks$, progression$, clickedLocation$ /*, changeLocationButtons$//*, newLocation$*/ /*, locationsVTree$*/).map(function (_ref) {\n    var _ref2 = _slicedToArray(_ref, 4),\n        currentLocation = _ref2[0],\n        currentLocationLinks = _ref2[1],\n        progression = _ref2[2],\n        clickedLocation /*, changeLocationButtons*/ /*, newLocation*/ /*, locationsVTree*/ = _ref2[3];\n\n    return (0, _snabbdomJsx.html)(\n      'div',\n      null,\n      (0, _snabbdomJsx.html)(\n        'p',\n        null,\n        'Progression : ',\n        progression\n      ),\n      (0, _snabbdomJsx.html)(\n        'p',\n        null,\n        'Clicked location : ',\n        clickedLocation\n      ),\n      (0, _snabbdomJsx.html)(\n        'h1',\n        null,\n        currentLocation\n      ),\n      (0, _snabbdomJsx.html)(\n        'p',\n        null,\n        currentLocationLinks.map(function (currentLocationLink) {\n          return (0, _snabbdomJsx.html)(\n            'button',\n            { selector: '.js-change-location', type: 'button', value: currentLocationLink },\n            currentLocationLink\n          );\n        })\n      )\n    );\n  });\n  ///////////////////////////\n\n  var sinks = {\n    DOM: DOMSink$,\n    HTTP: jsonRequest$\n  };\n  return sinks;\n}\n\nvar drivers = {\n  DOM: (0, _dom.makeDOMDriver)('#app'),\n  HTTP: (0, _http.makeHTTPDriver)()\n};\n\n(0, _run.run)(main, drivers);\n"]}